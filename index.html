<!doctype html>
<html lang="en">
<head>
    <title>Artnet Weblight</title>

    <link href="./css/style.css" rel="stylesheet">
    <script src="/js/jquery.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        $(function () {
        
        console.log('init');
                    
                    
	  const iOS_1to12 = /iPad|iPhone|iPod/.test(navigator.platform);
  const iOS13_iPad = (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
  const iOS1to12quirk = function() {
    var audio = new Audio(); // temporary Audio object
    audio.volume = 0.5; // has no effect on iOS <= 12
    return audio.volume === 1;
  };
  const isIOS = !window.MSStream && (iOS_1to12 || iOS13_iPad || iOS1to12quirk());
  
		       //if (isIOS) document.getElementById('webkit_play').style.display = "flex";
		  var elem = document.documentElement;
		  //var vid = document.getElementById("videoa");
		  /* View in fullscreen */
		  function start() {
		  	//vid.play();
			this.innerText = initAudioContext();
			this.stop();
			this.play();
		  }
		  function openFullscreen() {
		    if (elem.requestFullscreen) {
		      elem.requestFullscreen();
		    } else if (elem.webkitRequestFullscreen) { /* Safari */
		      elem.webkitRequestFullscreen();
		    } else if (elem.msRequestFullscreen) { /* IE11 */
		      elem.msRequestFullscreen();
		    }
		  }
		 
		  /* Close fullscreen */
		  function closeFullscreen() {
		    if (document.exitFullscreen) {
		      document.exitFullscreen();
		    } else if (document.webkitExitFullscreen) { /* Safari */
		      document.webkitExitFullscreen();
		    } else if (document.msExitFullscreen) { /* IE11 */
		      document.msExitFullscreen();
		    }
		  }

		   $("body").click(function(event){
		    //start();
		    console.log(event);
		    
		    openFullscreen();
		  });
		  
            const socket = io();

            let deviceNr = window.location.pathname.substr(1);
            if (!deviceNr) deviceNr = 0;
            const deviceId = "dev" + deviceNr;

            const print = function (input) {
                return "Device " + deviceNr + " | Red: " + input.r + " Green: " + input.g + " Blue: " + input.b + " Alpha " + input.a +
                    " Border: " + input.border + " Blur: " + input.blur + " Image: " + input.image;
            };

            socket.on(deviceId, function (msg) {
                if (window.location.search.substr(1) === 'debug') {
                    $('#debug').text(print(msg));
                    $('#debug').css('display', 'inline');
                }

                $('body').css('background-color', 'rgba(' + msg.r + ', ' + msg.g + ', ' + msg.b + ', ' + msg.a + ')');

                const screenSizeMax = window.innerWidth < window.innerHeight ? window.innerWidth : window.innerHeight;
                $('body').css('box-shadow', '0px 0px ' + (msg.blur / 255 * screenSizeMax / 4) + 'px ' + (msg.border / 255 * screenSizeMax / 2 + 1) + 'px #000000 inset');

                if (msg.image !== "none") {
                    $('body').css('background-image', 'url(/' + msg.image + ')');
                } else {
                    $('body').css('background-image', '');
                }

            });
        });
    </script>
</head>
<body>

<div>
    <span id="debug"></span>
</div>

<!--<div id="circlebox"></div>-->

</body>
</html>
